<nav class="navbar">
    <div class="navbar__container">
        <div class="navbar__brand">
            <img src="/imgs/mark.svg" width="26" height="26">
            <span data-i18n="brand">HTMLé—¨æˆ·æ¨¡æ¿</span>
        </div>
        
        <ul class="navbar__menu">
            <li class="navbar__item">
                <a href="home.html" class="navbar__link" data-i18n="nav.home">é¦–é¡µ</a>
            </li>
            
            <!-- æœåŠ¡ä¸‹æ‹‰èœå• -->
            <li class="navbar__item navbar__item--dropdown">
                <button class="navbar__language-toggle navbar__link navbar__link--dropdown">
                    <span data-i18n="nav.services.main">æœåŠ¡é¡¹ç›®</span>
                    <span class="navbar__dropdown-arrow">â–¼</span>
                </button>
                <ul class="navbar__dropdown-menu">
                   <li class="navbar__dropdown-item">
                        <a href="services.html#website" class="navbar__dropdown-link" data-i18n="nav.services.websiteDev">ç½‘ç«™å¼€å‘</a>
                    </li>
                    <li class="navbar__dropdown-item">
                        <a href="services.html#app" class="navbar__dropdown-link" data-i18n="nav.services.appDev">åº”ç”¨å¼€å‘</a>
                    </li>
                    <li class="navbar__dropdown-item">
                        <a href="services.html#ui" class="navbar__dropdown-link" data-i18n="nav.services.uiDesign">UIè®¾è®¡</a>
                    </li>
                    <li class="navbar__dropdown-item">
                        <a href="services.html#consulting" class="navbar__dropdown-link" data-i18n="nav.services.consulting">æŠ€æœ¯å’¨è¯¢</a>
                    </li>
                </ul>
            </li>
            
            <li class="navbar__item">
                <a href="about.html" class="navbar__link" data-i18n="nav.about">å…³äºæˆ‘ä»¬</a>
            </li>
            
            <li class="navbar__item">
                <a href="contact.html" class="navbar__link" data-i18n="nav.contact">è”ç³»æˆ‘ä»¬</a>
            </li>
        </ul>
        
        <!-- è¯­è¨€åˆ‡æ¢ä¸‹æ‹‰èœå• -->
        <div class="navbar__language navbar__item--dropdown">
            <button class="navbar__language-toggle navbar__link navbar__link--dropdown">
                <span class="navbar__language-current">ä¸­æ–‡</span>
                <span class="navbar__dropdown-arrow">â–¼</span>
            </button>
            <ul class="navbar__dropdown-menu navbar__dropdown-menu--language">
                <li class="navbar__dropdown-item">
                    <button class="navbar__language-option" data-lang="zh-CN">
                        <span class="navbar__language-flag">ğŸ‡¨ğŸ‡³</span>
                        <span>ä¸­æ–‡</span>
                    </button>
                </li>
                <li class="navbar__dropdown-item">
                    <button class="navbar__language-option" data-lang="en-US">
                        <span class="navbar__language-flag">ğŸ‡ºğŸ‡¸</span>
                        <span>English</span>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<style>
/* åŸºç¡€å¯¼èˆªæ ·å¼ */
.navbar {
    background: #2c3e50;
    color: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.navbar__container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 70px;
}

.navbar__brand {
    font-size: 1.5rem;
    font-weight: bold;
    color: #3498db;

    span {
        position: relative;
        top: -4px;
    }
}

.navbar__menu {
    display: flex;
    list-style: none;
    gap: 0;
    margin: 0;
    padding: 0;
    height: 100%;
    align-items: center;
}

.navbar__item {
    height: 100%;
    display: flex;
    align-items: center;
    position: relative;
}

.navbar__link {
    color: white;
    text-decoration: none;
    padding: 0 1.5rem;
    height: 100%;
    display: flex;
    align-items: center;
    transition: background-color 0.3s;
    position: relative;
    white-space: nowrap;
    background: none;
    border: none;
    font-family: inherit;
    font-size: inherit;
    cursor: pointer;
}

.navbar__link:hover,
.navbar__link--active {
    background-color: #34495e;
}

/* ä¸‹æ‹‰èœå•æ ·å¼ */
.navbar__item--dropdown {
    position: relative;
}

.navbar__link--dropdown {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-right: 1.2rem;
}

.navbar__dropdown-arrow {
    font-size: 0.6em;
    margin-left: 0.3rem;
    transition: transform 0.3s ease;
    opacity: 0.8;
}

.navbar__item--dropdown:hover .navbar__dropdown-arrow {
    transform: rotate(180deg);
}

.navbar__dropdown-menu {
    position: absolute;
    top: 100%;
    background: white;
    min-width: 180px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    border-radius: 0 0 8px 8px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-5px);
    transition: all 0.3s ease;
    z-index: 1001;
    list-style: none;
    margin: 0;
    padding: 0;
    border-top: 3px solid #3498db;
}

.navbar__dropdown-menu--language {
    right: 0;
    left: auto;
    min-width: 160px;
}

.navbar__item--dropdown:hover .navbar__dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.navbar__dropdown-item {
    border-bottom: 1px solid #f5f5f5;
}

.navbar__dropdown-item:last-child {
    border-bottom: none;
}

.navbar__dropdown-link {
    display: block;
    padding: 0.8rem 1.2rem;
    color: #333;
    text-decoration: none;
    transition: all 0.2s ease;
    font-size: 0.95rem;
    white-space: nowrap;
    text-align: left;
    width: 100%;
    background: none;
    border: none;
    font-family: inherit;
}

.navbar__dropdown-link:hover {
    background-color: #3498db;
    color: white;
    padding-left: 1.5rem;
}

/* è¯­è¨€åˆ‡æ¢å™¨æ ·å¼ */
.navbar__language {
    position: relative;
    height: 100%;
    display: flex;
    align-items: center;
}

.navbar__language-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0 1.2rem;
    color: white;
    background: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
    font-size: inherit;
    height: 100%;
}

.navbar__language-current {
    font-size: 0.95rem;
}

.navbar__language-option {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    padding: 0.8rem 1.2rem;
    color: #333;
    text-decoration: none;
    transition: all 0.2s ease;
    font-size: 0.95rem;
    white-space: nowrap;
    text-align: left;
    width: 100%;
    background: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
}

.navbar__language-option:hover {
    background-color: #3498db;
    color: white;
    padding-left: 1.5rem;
}

.navbar__language-flag {
    font-size: 1.1rem;
    width: 20px;
    text-align: center;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
    .navbar__container {
        flex-direction: column;
        height: auto;
        padding: 1rem;
    }
    
    .navbar__menu {
        flex-direction: column;
        width: 100%;
        margin: 1rem 0;
        gap: 0;
    }
    
    .navbar__item {
        width: 100%;
        height: auto;
        border-bottom: 1px solid #34495e;
    }
    
    .navbar__item:last-child {
        border-bottom: none;
    }
    
    .navbar__link {
        padding: 1rem 1.5rem;
        width: 100%;
        justify-content: space-between;
    }
    
    .navbar__link--dropdown::after {
        content: "â€º";
        transform: rotate(90deg);
        transition: transform 0.3s;
    }
    
    .navbar__dropdown-menu {
        position: static;
        opacity: 1;
        visibility: visible;
        transform: none;
        box-shadow: none;
        background: #34495e;
        display: none;
        width: 100%;
        border-radius: 0;
        border-top: none;
        margin-left: 1rem;
    }
    
    .navbar__dropdown-menu--language {
        margin-left: 0;
    }
    
    .navbar__dropdown-link,
    .navbar__language-option {
        color: #ecf0f1;
        padding: 0.8rem 1.2rem;
        border-bottom: 1px solid #2c3e50;
    }
    
    .navbar__dropdown-link:hover,
    .navbar__language-option:hover {
        background-color: #3498db;
        padding-left: 1.5rem;
    }
    
    .navbar__dropdown-item:last-child .navbar__dropdown-link,
    .navbar__dropdown-item:last-child .navbar__language-option {
        border-bottom: none;
    }
    
    .navbar__item--dropdown.active .navbar__dropdown-menu {
        display: block;
    }
    
    .navbar__item--dropdown.active .navbar__link--dropdown::after {
        transform: rotate(-90deg);
    }
    
    .navbar__language {
        width: 100%;
        border-bottom: 1px solid #34495e;
    }
    
    .navbar__language-toggle {
        width: 100%;
        justify-content: space-between;
    }
}
</style>

<script>
// å¯¼èˆªæ åŠŸèƒ½ - ç‹¬ç«‹è„šæœ¬
(function() {
    'use strict';
    
    console.log('ğŸš€ å¯¼èˆªæ è„šæœ¬å¼€å§‹åŠ è½½...');
    
    // ç­‰å¾…DOMå®Œå…¨åŠ è½½
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initNavbar);
    } else {
        initNavbar();
    }
    
    function initNavbar() {
        console.log('ğŸ¯ åˆå§‹åŒ–å¯¼èˆªæ ...');
        
        // åˆå§‹åŒ–è¯­è¨€æ˜¾ç¤º
        initLanguageDisplay();
        
        // è®¾ç½®ä¸‹æ‹‰èœå•äº‹ä»¶
        setupDropdowns();
        
        // è®¾ç½®è¯­è¨€åˆ‡æ¢äº‹ä»¶
        setupLanguageSwitcher();
        
        console.log('âœ… å¯¼èˆªæ åˆå§‹åŒ–å®Œæˆ');
    }
    
    function setupDropdowns() {
        console.log('ğŸ”„ è®¾ç½®ä¸‹æ‹‰èœå•...');
        
        // æ¡Œé¢ç«¯æ‚¬åœæ•ˆæœ
        const dropdownItems = document.querySelectorAll('.navbar__item--dropdown');
        dropdownItems.forEach(item => {
            item.addEventListener('mouseenter', function() {
                if (window.innerWidth > 768) {
                    this.classList.add('hover');
                }
            });
            
            item.addEventListener('mouseleave', function() {
                if (window.innerWidth > 768) {
                    this.classList.remove('hover');
                }
            });
        });
        
        // ç§»åŠ¨ç«¯ç‚¹å‡»æ•ˆæœ
        const dropdownToggles = document.querySelectorAll('.navbar__link--dropdown, .navbar__language-toggle');
        console.log(`æ‰¾åˆ° ${dropdownToggles.length} ä¸ªä¸‹æ‹‰åˆ‡æ¢æŒ‰é’®`);
        
        dropdownToggles.forEach(toggle => {
            toggle.addEventListener('click', function(e) {
                console.log('ğŸ“± ç§»åŠ¨ç«¯ä¸‹æ‹‰èœå•ç‚¹å‡»');
                if (window.innerWidth <= 768) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const dropdown = this.closest('.navbar__item--dropdown');
                    const isActive = dropdown.classList.contains('active');
                    
                    // å…³é—­æ‰€æœ‰å…¶ä»–ä¸‹æ‹‰èœå•
                    document.querySelectorAll('.navbar__item--dropdown').forEach(item => {
                        if (item !== dropdown) {
                            item.classList.remove('active');
                        }
                    });
                    
                    // åˆ‡æ¢å½“å‰ä¸‹æ‹‰èœå•
                    dropdown.classList.toggle('active', !isActive);
                }
            });
        });
        
        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.navbar__item--dropdown')) {
                document.querySelectorAll('.navbar__item--dropdown').forEach(item => {
                    item.classList.remove('active');
                    item.classList.remove('hover');
                });
            }
        });
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç½®
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.querySelectorAll('.navbar__item--dropdown').forEach(item => {
                    item.classList.remove('active');
                });
            }
        });
    }
    
    function setupLanguageSwitcher() {
        console.log('ğŸŒ è®¾ç½®è¯­è¨€åˆ‡æ¢å™¨...');
        
        const languageOptions = document.querySelectorAll('.navbar__language-option');
        console.log(`æ‰¾åˆ° ${languageOptions.length} ä¸ªè¯­è¨€é€‰é¡¹`);
        
        languageOptions.forEach(option => {
            // ç§»é™¤æ‰€æœ‰ç°æœ‰çš„äº‹ä»¶ç›‘å¬å™¨
            const newOption = option.cloneNode(true);
            option.parentNode.replaceChild(newOption, option);
            
            // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
            newOption.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const lang = this.getAttribute('data-lang');
                console.log(`ğŸ¯ è¯­è¨€åˆ‡æ¢ç‚¹å‡»: ${lang}`);
                
                // æ›´æ–°å½“å‰è¯­è¨€æ˜¾ç¤º
                updateCurrentLanguageDisplay(lang);
                
                // è§¦å‘è¯­è¨€åˆ‡æ¢
                triggerLanguageChange(lang);
                
                // å…³é—­ä¸‹æ‹‰èœå•
                closeAllDropdowns();
            });
        });
        
        console.log('âœ… è¯­è¨€åˆ‡æ¢å™¨è®¾ç½®å®Œæˆ');
    }
    
    function updateCurrentLanguageDisplay(lang) {
        const currentLangElement = document.querySelector('.navbar__language-current');
        const languageMap = {
            'zh-CN': 'ä¸­æ–‡',
            'en-US': 'English'
        };
        
        if (currentLangElement && languageMap[lang]) {
            currentLangElement.textContent = languageMap[lang];
            console.log(`ğŸ“ æ›´æ–°è¯­è¨€æ˜¾ç¤ºä¸º: ${languageMap[lang]}`);
        }
        
        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem('portal_language', lang);
        console.log(`ğŸ’¾ ä¿å­˜è¯­è¨€åˆ°æœ¬åœ°å­˜å‚¨: ${lang}`);
    }
    
    function triggerLanguageChange(lang) {
        console.log(`ğŸ”„ è§¦å‘è¯­è¨€åˆ‡æ¢: ${lang}`);
        
        // æ–¹æ³•1: ä½¿ç”¨å…¨å±€å‡½æ•°
        if (typeof window.changeLanguage === 'function') {
            console.log('ğŸ”§ ä½¿ç”¨å…¨å±€ changeLanguage å‡½æ•°');
            window.changeLanguage(lang);
            return;
        }
        
        // æ–¹æ³•2: ä½¿ç”¨åˆå§‹åŒ–å‡½æ•°
        if (typeof window.initI18n === 'function') {
            console.log('ğŸ”§ ä½¿ç”¨å…¨å±€ initI18n å‡½æ•°');
            // ä¿å­˜è¯­è¨€è®¾ç½®åé‡æ–°åˆå§‹åŒ–
            localStorage.setItem('portal_language', lang);
            window.initI18n();
            return;
        }
        
        // æ–¹æ³•3: ä½¿ç”¨æœ¬åœ°å‡½æ•°
        console.log('ğŸ”§ ä½¿ç”¨æœ¬åœ°è¯­è¨€åˆ‡æ¢å‡½æ•°');
        switchLanguage(lang);
    }
    
    async function switchLanguage(lang) {
        console.log(`ğŸŒ å¼€å§‹åˆ‡æ¢è¯­è¨€åˆ°: ${lang}`);
        
        try {
            // ç¡®å®šåŸºç¡€è·¯å¾„
            let basePath = './';
            const currentPath = window.location.pathname;
            
            if (currentPath.includes('/pages/services/')) {
                basePath = '../../';
            } else if (currentPath.includes('/pages/')) {
                basePath = '../';
            }
            
            console.log(`ğŸ“ åŸºç¡€è·¯å¾„: ${basePath}`);
            
            const response = await fetch(`${basePath}locales/${lang}.json`);
            
            if (!response.ok) {
                throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
            }
            
            const translations = await response.json();
            console.log('âœ… åŠ è½½è¯­è¨€æ–‡ä»¶æˆåŠŸ');
            
            // åº”ç”¨ç¿»è¯‘
            applyTranslations(translations, lang);
            
        } catch (error) {
            console.error('âŒ åˆ‡æ¢è¯­è¨€å¤±è´¥:', error);
        }
    }
    
    function applyTranslations(translations, lang) {
        let translatedCount = 0;
        
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = getNestedTranslation(translations, key);
            
            if (translation) {
                element.textContent = translation;
                translatedCount++;
            }
        });
        
        console.log(`ğŸ“Š ç¿»è¯‘äº† ${translatedCount} ä¸ªå…ƒç´ `);
        
        // æ›´æ–°é¡µé¢æ ‡é¢˜
        updatePageTitle(translations);
        
        // æ›´æ–°HTML langå±æ€§
        document.documentElement.lang = lang;
        
        console.log(`âœ… è¯­è¨€åˆ‡æ¢å®Œæˆ: ${lang}`);
    }
    
    function updatePageTitle(translations) {
        const titleElement = document.querySelector('title');
        if (titleElement) {
            const titleKey = titleElement.getAttribute('data-i18n');
            if (titleKey) {
                const titleTranslation = getNestedTranslation(translations, titleKey);
                if (titleTranslation) {
                    document.title = titleTranslation;
                    console.log('ğŸ“„ æ›´æ–°é¡µé¢æ ‡é¢˜:', titleTranslation);
                }
            }
        }
    }
    
    function getNestedTranslation(obj, key) {
        return key.split('.').reduce((o, i) => o?.[i], obj);
    }
    
    function initLanguageDisplay() {
        const currentLang = localStorage.getItem('portal_language') || 'zh-CN';
        console.log(`ğŸ” åˆå§‹åŒ–è¯­è¨€æ˜¾ç¤ºï¼Œå½“å‰è¯­è¨€: ${currentLang}`);
        updateCurrentLanguageDisplay(currentLang);
    }
    
    function closeAllDropdowns() {
        document.querySelectorAll('.navbar__item--dropdown').forEach(item => {
            item.classList.remove('active');
            item.classList.remove('hover');
        });
    }
    
    // å¯¼å‡ºå‡½æ•°åˆ°å…¨å±€ä½œç”¨åŸŸï¼ˆç”¨äºè°ƒè¯•ï¼‰
    window.navbarDebug = {
        initLanguageDisplay,
        switchLanguage,
        triggerLanguageChange
    };
    
})();
</script>