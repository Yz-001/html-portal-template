<nav class="navbar">
    <div class="navbar__container">
        <div class="navbar__brand">
            <img src="/imgs/mark.svg" width="26" height="26">
            <span data-i18n="brand">HTMLÈó®Êà∑Ê®°Êùø</span>
        </div>
        
        <ul class="navbar__menu">
            <li class="navbar__item">
                <a href="home.html" class="navbar__link" data-i18n="nav.home">È¶ñÈ°µ</a>
            </li>
            
            <li class="navbar__item navbar__item--dropdown">
                <button class="navbar__link navbar__link--dropdown">
                    <span data-i18n="nav.services.main">ÊúçÂä°È°πÁõÆ</span>
                    <span class="navbar__dropdown-arrow">‚ñº</span>
                </button>
                <ul class="navbar__dropdown-menu">
                   <li class="navbar__dropdown-item">
                        <a href="services.html#website" class="navbar__dropdown-link" data-i18n="nav.services.websiteDev">ÁΩëÁ´ôÂºÄÂèë</a>
                    </li>
                    <li class="navbar__dropdown-item">
                        <a href="services.html#app" class="navbar__dropdown-link" data-i18n="nav.services.appDev">Â∫îÁî®ÂºÄÂèë</a>
                    </li>
                    <li class="navbar__dropdown-item">
                        <a href="services.html#ui" class="navbar__dropdown-link" data-i18n="nav.services.uiDesign">UIËÆæËÆ°</a>
                    </li>
                    <li class="navbar__dropdown-item">
                        <a href="services.html#consulting" class="navbar__dropdown-link" data-i18n="nav.services.consulting">ÊäÄÊúØÂí®ËØ¢</a>
                    </li>
                </ul>
            </li>
            
            <li class="navbar__item">
                <a href="about.html" class="navbar__link" data-i18n="nav.about">ÂÖ≥‰∫éÊàë‰ª¨</a>
            </li>
            
            <li class="navbar__item">
                <a href="contact.html" class="navbar__link" data-i18n="nav.contact">ËÅîÁ≥ªÊàë‰ª¨</a>
            </li>
        </ul>
        
        <div class="navbar__language navbar__item--dropdown">
            <button class="navbar__link navbar__link--dropdown">
                <span class="navbar__language-current">‰∏≠Êñá</span>
                <span class="navbar__dropdown-arrow">‚ñº</span>
            </button>
            <ul class="navbar__dropdown-menu">
                <li class="navbar__dropdown-item">
                    <button class="navbar__language-option" data-lang="zh-CN">
                        <span class="navbar__language-flag">üá®üá≥</span>
                        <span>‰∏≠Êñá</span>
                    </button>
                </li>
                <li class="navbar__dropdown-item">
                    <button class="navbar__language-option" data-lang="en-US">
                        <span class="navbar__language-flag">üá∫üá∏</span>
                        <span>English</span>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<style>
.navbar {
    background: #2c3e50;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.navbar__container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 70px;
}

.navbar__brand {
    font-size: 1.5rem;
    font-weight: bold;
    color: #3498db;
    display: flex;
    align-items: center;
    gap: 8px;
}

.navbar__menu {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    height: 100%;
    align-items: center;
}

.navbar__item {
    height: 100%;
    display: flex;
    align-items: center;
    position: relative;
}

.navbar__link {
    color: #ecf0f1;
    text-decoration: none;
    padding: 0 1.5rem;
    height: 100%;
    display: flex;
    align-items: center;
    transition: all 0.3s ease;
    position: relative;
    white-space: nowrap;
    background: none;
    border: none;
    font-family: inherit;
    font-size: inherit;
    cursor: pointer;
    font-weight: 500;
}

.navbar__link:hover {
    color: white;
    background-color: rgba(52, 73, 94, 0.8);
}

.navbar__link--active {
    color: white;
    background-color: rgba(52, 152, 219, 0.15);
}

.navbar__link--active::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: #3498db;
}

.navbar__item--dropdown {
    position: relative;
}

.navbar__link--dropdown {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-right: 1.2rem;
}

.navbar__dropdown-arrow {
    font-size: 0.6em;
    transition: transform 0.3s ease;
}

.navbar__item--dropdown:hover .navbar__dropdown-arrow {
    transform: rotate(180deg);
}

.navbar__dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    background: white;
    min-width: 180px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    border-radius: 0 0 8px 8px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-5px);
    transition: all 0.3s ease;
    z-index: 1001;
    list-style: none;
    margin: 0;
    padding: 0;
    border-top: 2px solid #3498db;
}

.navbar__language .navbar__dropdown-menu {
    left: auto;
    right: 0;
}

.navbar__item--dropdown:hover .navbar__dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.navbar__dropdown-item {
    border-bottom: 1px solid #f8f9fa;
}

.navbar__dropdown-item:last-child {
    border-bottom: none;
}

.navbar__dropdown-link,
.navbar__language-option {
    display: block;
    padding: 0.8rem 1.2rem;
    color: #2c3e50;
    text-decoration: none;
    transition: all 0.2s ease;
    font-size: 0.95rem;
    white-space: nowrap;
    text-align: left;
    width: 100%;
    background: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
}

.navbar__dropdown-link:hover,
.navbar__language-option:hover {
    background-color: #3498db;
    color: white;
}

.navbar__language {
    position: relative;
    height: 100%;
    display: flex;
    align-items: center;
}

.navbar__language-option {
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.navbar__language-flag {
    font-size: 1.1rem;
    width: 20px;
    text-align: center;
}

@media (max-width: 768px) {
    .navbar__container {
        flex-direction: column;
        height: auto;
        padding: 1rem;
    }
    
    .navbar__menu {
        flex-direction: column;
        width: 100%;
        margin: 1rem 0;
    }
    
    .navbar__item {
        width: 100%;
        height: auto;
        border-bottom: 1px solid #34495e;
    }
    
    .navbar__link {
        padding: 1rem 1.5rem;
        width: 100%;
        justify-content: space-between;
    }
    
    .navbar__dropdown-menu {
        position: static;
        box-shadow: none;
        background: #34495e;
        display: none;
        width: 100%;
        border-radius: 0;
        border-top: none;
        opacity: 1;
        visibility: visible;
        transform: none;
    }
    
    .navbar__dropdown-link,
    .navbar__language-option {
        color: #ecf0f1;
        border-bottom: 1px solid #2c3e50;
    }
    
    .navbar__item--dropdown.active .navbar__dropdown-menu {
        display: block;
    }
    
    .navbar__language {
        width: 100%;
        border-bottom: 1px solid #34495e;
    }
    
    .navbar__link--active::before {
        display: none;
    }
}
</style>

<script>
class Navbar {
    constructor() {
        this.pageMap = {
            'home.html': { type: 'home', selector: '.navbar__link[href="home.html"]' },
            'index.html': { type: 'home', selector: '.navbar__link[href="home.html"]' },
            '': { type: 'home', selector: '.navbar__link[href="home.html"]' },
            'services.html': { type: 'services', selector: '.navbar__item--dropdown .navbar__link' },
            'about.html': { type: 'about', selector: '.navbar__link[href="about.html"]' },
            'contact.html': { type: 'contact', selector: '.navbar__link[href="contact.html"]' }
        };
        
        this.languages = {
            'zh-CN': '‰∏≠Êñá',
            'en-US': 'English'
        };
        
        this.init();
    }
    
    init() {
        this.initLanguage();
        this.highlightActive();
        this.bindEvents();
    }
    
    initLanguage() {
        const lang = localStorage.getItem('portal_language') || 'zh-CN';
        this.updateLanguageDisplay(lang);
    }
    
    highlightActive() {
        const currentPage = this.getCurrentPage();
        const pageConfig = this.pageMap[currentPage] || this.pageMap['home.html'];
        
        // ÁßªÈô§ÊâÄÊúâÈ´ò‰∫Æ
        document.querySelectorAll('.navbar__link').forEach(link => {
            link.classList.remove('navbar__link--active');
        });
        
        // ËÆæÁΩÆÂΩìÂâçÈ°µÈù¢È´ò‰∫Æ
        if (pageConfig && pageConfig.selector) {
            const activeElement = document.querySelector(pageConfig.selector);
            if (activeElement) {
                activeElement.classList.add('navbar__link--active');
            }
        }
    }
    
    getCurrentPage() {
        return window.location.pathname.split('/').pop() || 'home.html';
    }
    
    bindEvents() {
        // ‰∏ãÊãâËèúÂçï
        const dropdowns = document.querySelectorAll('.navbar__item--dropdown');
        
        dropdowns.forEach(dropdown => {
            // Ê°åÈù¢Á´ØÊÇ¨ÂÅú
            dropdown.addEventListener('mouseenter', () => {
                if (window.innerWidth > 768) dropdown.classList.add('hover');
            });
            
            dropdown.addEventListener('mouseleave', () => {
                if (window.innerWidth > 768) dropdown.classList.remove('hover');
            });
            
            // ÁßªÂä®Á´ØÁÇπÂáª
            const toggle = dropdown.querySelector('.navbar__link--dropdown');
            toggle.addEventListener('click', (e) => {
                if (window.innerWidth <= 768) {
                    e.preventDefault();
                    dropdown.classList.toggle('active');
                }
            });
        });
        
        // ËØ≠Ë®ÄÂàáÊç¢
        document.querySelectorAll('.navbar__language-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.preventDefault();
                const lang = e.target.closest('[data-lang]').getAttribute('data-lang');
                this.switchLanguage(lang);
            });
        });
        
        // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.navbar__item--dropdown')) {
                dropdowns.forEach(dropdown => {
                    dropdown.classList.remove('active', 'hover');
                });
            }
        });
    }
    
    switchLanguage(lang) {
        this.updateLanguageDisplay(lang);
        
        if (window.changeLanguage) {
            window.changeLanguage(lang);
        } else if (window.initI18n) {
            localStorage.setItem('portal_language', lang);
            window.initI18n();
        } else {
            this.loadTranslations(lang);
        }
        
        this.closeAllDropdowns();
    }
    
    updateLanguageDisplay(lang) {
        const currentLangEl = document.querySelector('.navbar__language-current');
        if (currentLangEl && this.languages[lang]) {
            currentLangEl.textContent = this.languages[lang];
        }
        localStorage.setItem('portal_language', lang);
    }
    
    async loadTranslations(lang) {
        try {
            let basePath = './';
            const path = window.location.pathname;
            if (path.includes('/pages/services/')) basePath = '../../';
            else if (path.includes('/pages/')) basePath = '../';
            
            const response = await fetch(`${basePath}locales/${lang}.json`);
            const translations = await response.json();
            this.applyTranslations(translations, lang);
        } catch (error) {
            console.error('ËØ≠Ë®ÄÂàáÊç¢Â§±Ë¥•:', error);
        }
    }
    
    applyTranslations(translations, lang) {
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const value = key.split('.').reduce((obj, k) => obj?.[k], translations);
            if (value) element.textContent = value;
        });
        
        document.documentElement.lang = lang;
    }
    
    closeAllDropdowns() {
        document.querySelectorAll('.navbar__item--dropdown').forEach(dropdown => {
            dropdown.classList.remove('active', 'hover');
        });
    }
}

// ÂàùÂßãÂåñÂØºËà™Ê†è
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => new Navbar());
} else {
    new Navbar();
}
</script>